<!DOCTYPE html>
<html>
    <head>
        <title>API Key | Contact Book</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <div class="loader-wrapper">
                    <div class="loader"></div>
        </div>
        <div class="api-key-container">
            <h2>Contact Book Authentication</h2>
            <div>Please enter your API key to access the Contact Book</div>
            <form class="api-key-form">
                <input type="email" id="apiKey" name="apiKey" placeholder="Enter your API key"/>
                <button id="submitApiKey">Submit</button>
            </form>
        </div>

                <div id="myLink">
            <p>© 2025, Phōtizō. All rights reserved.</p>
        </div>

                <script>
                    window.addEventListener("load", function() {
                        document.querySelector('.loader-wrapper').style.opacity = '0';
                        setTimeout(function() {
                             document.querySelector('.loader-wrapper').style.display = 'none';
                        }, 500);
                    });
                </script>
        <script>
            let rootPath = "https://mysite.itvarsity.org/api/ContactBook/";
            document.getElementById("submitApiKey").addEventListener('click', setApiKey);

            function setApiKey(e){
                e.preventDefault();
                
                apiKey = document.getElementById("apiKey").value;
                fetch(rootPath + "controller/api-key/?apiKey=" + apiKey)
                        .then(function (response) {
                            return response.text();
                        })
                        .then(function (data) {
                            
                            if (data == "1") {
                                localStorage.setItem("apiKey", apiKey);
                                window.open("index.html", "_self");
                            } else {
                                alert("Invalid API key entered!");
                            }
                        })
            }
        </script>
    </body>
</html>
